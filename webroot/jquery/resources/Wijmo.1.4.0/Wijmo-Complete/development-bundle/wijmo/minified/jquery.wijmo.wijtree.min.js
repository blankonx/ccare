/*
 *
 * Wijmo Library 1.4.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijtree",{options:{allowDrag:false,allowDrop:false,allowEdit:false,allowSorting:true,allowTriState:true,autoCheckNodes:true,autoCollapse:false,disabled:false,expandCollapseHoverUsed:false,showCheckBoxes:false,showExpandCollapse:true,expandAnimation:{effect:"blind",easing:"easeOutExpo",duration:200},expandDelay:0,collapseAnimation:{effect:"blind",easing:"easeOutExpo",duration:200},collapseDelay:0,nodeBlur:null,nodeClick:null,nodeCheckChanged:null,nodeCollapsed:null,nodeExpanded:null,nodeDragging:null,nodeDragStarted:null,nodeDropped:null,nodeMouseOver:null,nodeMouseOut:null,nodeTextChanged:null,selectedNodeChanged:null},_create:function(){this._initState();this._createTree();this._attachEvent();this._attachNodeEvent()},_setOption:function(f,c){var b=this,e=false,d;switch(f){case"allowDrag":b._setAllowDrag(c);break;case"allowDrop":b._setAllowDrop(c);break;case"showCheckBoxes":b._setCheckBoxes(c);break;case"showExpandCollapse":if(b.options.showExpandCollapse!==c)e=true;break;case"disabled":if(c)b.widgetDom.addClass("ui-state-disabled");else b.widgetDom.removeClass("ui-state-disabled");d=b.element.find(":wijmo-wijtreecheck");d.length&&d.wijtreecheck("option","disabled",c)}a.Widget.prototype._setOption.apply(b,arguments);e===true&&b._setHitArea(c)},_initState:function(){var a=this;a._selectedNodes=[];a._checkedNodes=[];a._enabled=true;a._insertPosition="unKnown";a.nodeWidgetName="wijtreenode"},_createTree:function(){var b=this,e=b.options,c=[],f,d="wijmo-wijtree ui-widget ui-widget-content ui-helper-clearfix ui-corner-all";if(b.element.is("ul")){b.$nodes=b.element;b.element.wrap("<div></div>");b.widgetDom=b.element.parent()}else if(b.element.is("div")){b.widgetDom=b.element;b.$nodes=b.widgetDom.children("ul:eq(0)")}if(b.$nodes.length){b.widgetDom.addClass(d).attr({role:"tree","aria-multiselectable":true});b.$nodes.addClass("wijmo-wijtree-list ui-helper-reset");c=b._createChildNodes();b._hasChildren=c.length>0;b._setField("nodes",c);b.nodes=c;b.widgetDom.append(a("<div>").css("clear","both"))}e.disabled&&b.disable()},_createChildNodes:function(){var b=this,d=b.options,c=[];b.$nodes.children("li").each(function(){var e=a(this);b._createNodeWidget(e,d);c.push(b._getNodeWidget(a(this)))});return c},_createNodeWidget:function(c,b){var e=this,d=e.nodeWidgetName;if(a.fn[d]){c.data("owner",this);if(!!b&&a.isPlainObject(b)){a.extend(b,{treeClass:this.widgetBaseClass});c[d](b)}else c[d]({treeClass:this.widgetBaseClass})}return c},_attachEvent:function(){var b=this;b.element.bind(a.browser.msie?"focusin.":"focus."+b.widgetName,a.proxy(b._onFocus,b)).bind("mouseover."+this.widgetName,a.proxy(b._onMouseOver,b));b.options.allowDrop&&b._attachDroppable()},_attachDroppable:function(){var b=this;b.widgetDom.droppable({drop:function(p,m){var c=m.draggable,d=b._getNodeWidget(c),f,h,g,e,o,j,l,k,n,i;if(d){f=d._dropTarget;if(f){h=d._insertPosition;if(f&&h!=="unKnown"){g=c.data("owner");if(g){n=c.index();g.remove(c)}if(!g.element.is(":"+b.widgetBaseClass)&&g._getField("nodes").length>0)b.options.showCheckBoxes&&b.options.allowTriState&&g._getField("nodes")[0]._setParentCheckState();if(h==="end"){c.show();i=f._getField("nodes").length;f.add(c);e=f}else if(h==="before"||h==="after"){e=f._getField("owner");o=e._getField("nodes");j=a.inArray(f,o);if(j!==-1){c.show();if(h==="before"){i=j;e.add(c,i)}else if(h==="after"){i=j+1;e.add(c,i)}}}if(!e.element.is(":"+b.widgetBaseClass)&&e._getField("nodes").length>0)b.options.showCheckBoxes&&b.options.allowTriState&&e._getField("nodes")[0]._setParentCheckState();a("a:eq(0)",c).blur();d._tree._isDragging=false;d.options.selected&&d._setSelected(false);d._tree=b;l=d._getField("nodes");for(k=0;k<l.length;k++)l[k]._tree=b;a.extend(m,{sourceParent:g.element,sIndex:n,targetParent:e.element,tIndex:i,widget:d});b._trigger("nodeDropped",p,m)}}else c.draggable("option","revert",true)}},accept:"li",scope:"tree"})},_attachNodeEvent:function(){this.element.bind("click."+this.widgetName,a.proxy(this._onClick,this)).bind("mouseout."+this.widgetName,a.proxy(this._onMouseOut,this)).bind("keydown."+this.widgetName,a.proxy(this._onKeyDown,this))},_onClick:function(b){this._callEvent(b,"_onClick");a.browser.webkit&&this.widgetDom.focus()},_onFocus:function(a){this._callEvent(a,"_onFocus")},_onKeyDown:function(a){this._callEvent(a,"_onKeyDown")},_onMouseOut:function(a){this._callEvent(a,"_onMouseOut")},_onMouseOver:function(a){this._callEvent(a,"_onMouseOver")},_callEvent:function(b,d){var c=b.target,a;if(c){a=this._getNodeWidgetByDom(c);if(a===null)return;a[d](b)}},_nodeSelector:function(){return":wijmo-wijtreenode"},getSelectedNodes:function(){return this._selectedNodes},getCheckedNodes:function(){var b=this,d=[],c=b.nodeWidgetName;a(b._nodeSelector(),b.element).each(function(){a(this)[c]("option","checked")&&a(this)[c]("option","checkState")!=="indeterminate"&&d.push(a(this))});return d},destroy:function(){var b=this,c=b.$nodes,d="wijmo-wijtree ui-widget ui-widget-content ui-helper-clearfix ui-corner-all";b.widgetDom.removeClass(d);b.widgetDom.data("droppable")&&b.widgetDom.droppable("destroy");c.removeData("nodes").removeClass("wijmo-wijtree-list ui-helper-reset");c.children("li").each(function(){var c=b._getNodeWidget(a(this));c&&c.destroy()});a.Widget.prototype.destroy.apply(this)},add:function(b,f){var d=null,i=this.options,c,g,e=this,h,j="<li><a href='{0}'>{1}</a></li>";if(typeof b==="string"){c=a(j.replace(/\{0\}/,"#").replace(/\{1\}/,b));e._createNodeWidget(c,i);d=c.data(c.data("widgetName"))}else if(b.jquery){!b.data("widgetName")&&e._createNodeWidget(b,i);d=b.data(b.data("widgetName"))}else if(b.nodeType){c=a(b);e._createNodeWidget(c,i);d=c.data(c.data("widgetName"))}else if(a.isPlainObject(b)){c=a(j.replace(/\{0\}/,b.url).replace(/\{1\}/,b.text));e._createNodeWidget(c,b);d=c.data(c.data("widgetName"))}if(d===null)return;g=e._getField("nodes");if(!f&&f>g.length)f=g.length;d._setField("owner",this);h=g.length;if(h>0&&h!==f)d.element.get(0)!==g[f].element.get(0)&&d.element.insertBefore(g[f].element);else e.$nodes.append(d.element);e._changeCollection(f,d);e._refreshNodesClass()},remove:function(b){var a=-1,d,c;if(b.jquery)a=b.index();else if(typeof b==="number")a=b;c=this._getField("nodes");if(a<0&&a>=c.length)return;d=c[a];d.element.detach();this._changeCollection(a);this._refreshNodesClass()},_changeCollection:function(c,a){var b=this._getField("nodes");if(a)b.splice(c,0,a);else b.splice(c,1)},findNodeByText:function(c){var b=a(".wijmo-wijtree-node a>span",this.$nodes).filter(function(){return a(this).text()===c});return b.length?this._getNodeWidgetByDom(b.get(0)):null},_setAllowDrag:function(f){var c=this,b,d=c._nodeSelector(),e=c.nodeWidgetName;if(f){b=c.element.find(d);b.each(function(){var b=a(this).data(e);if(!a(this).data("draggable")&&!b.$navigateUrl.data("events").mousedown)b.$navigateUrl.one("mousedown",b,b._onMouseDown)})}else{b=c.element.find(d+":ui-draggable");b.draggable("destroy")}},_setAllowDrop:function(a){if(a)!this.widgetDom.data("droppable")&&this._attachDroppable();else this.widgetDom.droppable&&this.widgetDom.droppable("destroy")},_setCheckBoxes:function(c){var b=this;b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!==null&&d._setCheckBoxes(c)})},_setHitArea:function(c){var b=this;b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!==null&&d._setHitArea(c)})},_getNodeWidget:function(a){return a.is(this._nodeSelector())?a.data(a.data("widgetName")):null},_getNodeWidgetByDom:function(b){var a=this._getNodeByDom(b);return this._getNodeWidget(a)},_getNodeByDom:function(b){return a(b).closest(this._nodeSelector())},_refreshNodesClass:function(){for(var b=this._getField("nodes"),a=0;a<b.length;a++)b[a]._initNodeClass()},_getField:function(a){return this.element.data(a)},_setField:function(b,a){return this.element.data(b,a)}})})(jQuery);(function(a){a.widget("wijmo.wijtreenode",{options:{accessKey:"",checked:false,collapsedIconClass:"",expanded:false,expandedIconClass:"",itemIconClass:"",navigateUrl:"",selected:false,text:"",toolTip:""},_setOption:function(e,c){var b=this,d;switch(e){case"accessKey":b.$navigateUrl!==null&&b.$navigateUrl.attr("accesskey",c);break;case"checked":b._checkState=c?"checked":"unChecked";b._setChecked(c);break;case"collapsedIconClass":case"expandedIconClass":case"itemIconClass":b.options[e]=c;b._initNodeImg();break;case"expanded":b._setExpanded(c);break;case"selected":b._setSelected(c);break;case"text":b._setText(c);break;case"toolTip":b._setToolTip(c);break;case"navigateUrl":b._setNavigateUrlHref(c);break;case"disabled":if(b._isClosestDisabled()&&c===true)return;d=b.element.find(":wijmo-wijtreecheck");d.length&&d.wijtreecheck("option","disabled",c)}a.Widget.prototype._setOption.apply(b,arguments)},_initState:function(){this._tree=null;this._dropTarget=null;this._checkState="unChecked";this._value=this._text=this._navigateUrl="";this._insertPosition="unKnown";this._hasNodes=false},_create:function(){this._initState();this._createTreeNode();this._initNode();this.element.data("widgetName",this.widgetName)},_createTreeNode:function(){var c=this.element,b=this,d=[];this.$navigateUrl=c.children("a");if(b._tree===null)b._tree=b._getTree();b.$nodeBody=null;b.$checkBox=null;b.$nodeImage=a("<span>");b.$hitArea=null;b.$nodes=null;b.$nodeBody=a("<div>").attr({role:"treeitem","aria-expanded":false,"aria-checked":false,"aria-selected":false});if(b._tree.options.showCheckBoxes===true)b.$checkBox=a("<div>");if(b.$navigateUrl.length===0){b.$navigateUrl=c.children("div");b.$navigateUrl.addClass("wijmo-wijtree-template");b._isTemplate=true}if(b.$navigateUrl.length===0){b.$navigateUrl=a("<a>");b.$navigateUrl.attr("href","#")}if(!b._isTemplate){b.$text=b.$navigateUrl.find("span:eq(0)");if(b.$text.length===0){b.$navigateUrl.wrapInner("<span></span>");b.$text=b.$navigateUrl.find("span:eq(0)")}}b._hasChildren=b._getChildren();b.$inner=a("<span></span>").addClass("ui-helper-clearfix wijmo-wijtree-inner ui-corner-all");d=b._createChildNodes(c);b.$inner.append(b.$nodeImage);if(b.$checkBox!==null){b.$inner.append(b.$checkBox);b.$checkBox.wijtreecheck()}b.$inner.append(b.$navigateUrl);b.$nodeBody.append(b.$inner);b._setField("nodes",d);c.prepend(b.$nodeBody)},_createChildNodes:function(c){var b=this,d=[];if(b._hasChildren){c.addClass("wijmo-wijtree-parent");b.$nodeBody.addClass("wijmo-wijtree-node wijmo-wijtree-header ui-state-default");b.$hitArea=a("<span>");b.$inner.prepend(b.$hitArea);b.$nodes=c.find("ul:eq(0)").addClass("wijmo-wijtree-list ui-helper-reset wijmo-wijtree-child");d=b._createChildNode()}else{c.addClass("wijmo-wijtree-item");b.$nodeBody.addClass("wijmo-wijtree-node ui-state-default")}return d},_createChildNode:function(){var b=this,c=[];b.$nodes.children().filter("li").each(function(f){var e=a(this),d;e.data("owner",b);e.wijtreenode(b.options);d=b._getNodeWidget(e);d._index=f;c.push(d)});return c},_initNode:function(){var a=this,b=a.options;if(!a._initialized){a._initialized=true;a._initNavigateUrl();if(!a._isTemplate&&a.$text){a._text=a.$text.html();b.text=a.$text.html()}a._hasChildren=a._getChildren();a._initNodesUL();a._initNodeClass();a._initNodeImg();a._initCheckBox();a.$navigateUrl.one("mousedown",a,a._onMouseDown)}},_initNodeClass:function(){var b=this,c=b.options,d="ui-icon "+(c.expanded?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e");if(b._tree.options.showExpandCollapse)if(b._hasChildren||!!c.hasChildren){if(b.$hitArea!==null)b.$hitArea.removeClass("ui-icon ui-icon-triangle-1-se ui-icon-triangle-1-e").addClass(d);else{b.$hitArea=a("<span>").addClass(d).prependTo(b.$inner);b.element.removeClass("wijmo-wijtree-node ui-state-default ui-corner-all").addClass("wijmo-wijtree-parent")}b._hasChildren&&b.$nodes[c.expanded?"show":"hide"]()}else if(b.$hitArea){b.$hitArea.remove();b.$hitArea=null;b.element.removeClass("wijmo-wijtree-parent").addClass("wijmo-wijtree-node ui-state-default ui-corner-all")}c.selected&&b.$inner&&b.$inner.addClass("ui-state-active")},_initCheckBox:function(){var a=this,b=a.options;if(a.$checkBox&&b.checkState)switch(b.checkState){case"checked":a.$checkBox.wijtreecheck("option","checkState","check");break;case"indeterminate":a.$checkBox.wijtreecheck("option","checkState","triState");break;case"unChecked":a.$checkBox.wijtreecheck("option","checkState","unCheck");break;default:a.$checkBox.wijtreecheck("option","checkState","unCheck")}},_initNodesUL:function(){var a=this;if(a._tree.options.showExpandCollapse)a._hasChildren&&a.$nodes[a._expanded?"show":"hide"]()},_initNavigateUrl:function(){var a=this,b=a.$navigateUrl.attr("href");a.$navigateUrl.bind("blur."+a.widgetName,a,a._onBlur);if(!this._isTemplate){a._navigateUrl=!!b?b:"";a._setNavigateUrlHref(b)}},_initNodeImg:function(){var b=this,c=this.options;if(this.$nodeImage===null||!this.$nodeImage.length)this.$nodeImage=a("<span>");if(b.element.attr("expandediconclass")){b.options.expandedIconClass=b.element.attr("expandediconclass");b.element.removeAttr("expandediconclass")}if(b.element.attr("collapsediconclass")){b.options.collapsedIconClass=b.element.attr("collapsediconclass");b.element.removeAttr("collapsediconclass")}if(b.element.attr("itemiconclass")){b.options.itemIconClass=b.element.attr("itemiconclass");b.element.removeAttr("itemiconclass")}if(b.options.collapsedIconClass!==""&&b.options.expandedIconClass!==""){this.$nodeImage.removeClass().addClass("ui-icon").addClass(c.expanded?c.expandedIconClass:c.collapsedIconClass);!b._tree.options.showExpandCollapse&&this.$nodeImage.addClass(b.options.expandedIconClass);this.$nodeImage.insertBefore(this.$checkBox)}else if(b.options.itemIconClass!==""){this.$nodeImage.removeClass().addClass("ui-icon");this.$nodeImage.addClass(b.options.itemIconClass);this.$nodeImage.insertBefore(this.$checkBox)}},_setNavigateUrlHref:function(a){if(this.$navigateUrl){if(a===""||typeof a==="undefined")a="#";this.$navigateUrl.attr("href",a)}},_editNode:function(){this._tree._editMode=true;this.$navigateUrl.hide();if(!this.$editArea)this.$editArea=a("<input>").wijtextbox();this.$editArea.val(this.$text.html());this.$editArea.insertBefore(this.$navigateUrl);this.$editArea.bind("blur",this,this._editionComplete);this.$editArea.focus()},_editionComplete:function(c){var a=c.data,b;a._tree._editMode=false;if(a.$editArea){b=a.$editArea.val();a.$editArea.remove()}a.$navigateUrl.show();a.$editArea=null;a._changeText(b)},_changeText:function(b){var a=this,c=a.options;if(a.$text!==null&&b!==""){a.$text.text(b);c.text=b;a._tree._trigger("nodeTextChanged",null,a)}},_expandCollapseItem:function(){var a=this,b=a.options;if(!a._tree.options.disabled&&!a._isClosestDisabled())(a._hasChildren||b.hasChildren)&&a._setExpanded(!b.expanded)},_expandNode:function(c){var a=this,b=a._tree.options;if(!b.disabled&&!a._isClosestDisabled())if(c)if(b.expandDelay>0){if(typeof a._expandTimer!=="undefined")a._expandTimer=window.clearTimeout(a._expandTimer);a._expandTimer=window.setTimeout(function(){a._expandNodeVisually()},b.expandDelay)}else a._expandNodeVisually();else if(b.collapseDelay>0){a._collapseTimer=window.clearTimeout(a._collapseTimer);a._collapseTimer=window.setTimeout(function(){a._collapseNodeVisually()},b.collapseDelay)}else a._collapseNodeVisually()},_expandNodeVisually:function(){var b=this,c;if(b._tree.options.autoCollapse){c=b.element.siblings(":"+this.widgetBaseClass);a.each(c,function(d){var a=b._getNodeWidget(c[d]);a.options.expanded&&a._setExpanded(false)})}b.options.collapsedIconClass!==""&&b.options.expandedIconClass!==""&&b.$nodeImage.removeClass(b.options.collapsedIconClass).addClass(b.options.expandedIconClass);b._internalSetNodeClass(true);b._show()},_collapseNodeVisually:function(){var a=this;a.options.collapsedIconClass!==""&&a.options.expandedIconClass!==""&&a.$nodeImage.removeClass(a.options.expandedIconClass).addClass(a.options.collapsedIconClass);a._internalSetNodeClass(false);a._hide()},_internalSetNodeClass:function(a){this.$hitArea.removeClass("ui-icon ui-icon-triangle-1-se ui-icon-triangle-1-e").addClass("ui-icon "+(a?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e"))},_show:function(){this._animation(true)},_hide:function(){this._animation(false)},_animation:function(d){var b=this,e=b.$nodes,c=d?"expandAnimation":"collapseAnimation",f=d?"nodeExpanded":"nodeCollapsed";if(e)if(b._tree.options[c])if(a.effects&&!!b._tree.options[c].duration)e[d?"show":"hide"](b._tree.options[c].effect,{},b._tree.options[c].duration,function(){b._tree._trigger(f,null,b)});else e[d?"show":"hide"](b._tree.options[c].duration,function(){b._tree._trigger(f,null,b)});else{e[d?"show":"hide"]();b._tree._trigger(f,null,b)}},_getBounds:function(a){var b=a.height(),e=a.width(),d=a.offset().top,c=a.offset().left;return{h:b,w:e,t:d,l:c}},_isMouseInsideRect:function(b,a){return b.x<a.l||b.x>=a.l+a.w?false:b.y<=a.t+1||b.y>=a.t+a.h?false:true},_getNodeByMouseOn:function(b){a("li").each(function(){var c=this._getBounds(a(this));if(a.ui.isOver(b.y,b.x,c.t,c.l,c.h,c.w))return a(this)});return null},_drowTemplate:function(b,e,d){var c="unKnown",f=d.is(".wijmo-wijtree-node")?d:d.children(".wijmo-wijtree-node"),a=this._getBounds(f);e.width(f.width());if(b.y>a.t&&b.y<a.t+a.h/2){e.offset({left:a.l,top:a.t});c="before"}else if(b.y>a.t+a.h/2&&b.y<a.t+a.h){e.offset({left:a.l,top:a.t+a.h});c="after"}return c},_beginDrag:function(e){var b=this,d=b.element,c;c=this._insertionTemplate=a("<div>").addClass("wijmo-wijtree-insertion ui-state-default").hide();d.draggable({cursor:"point",cursorAt:{top:15,left:-25},helper:function(){return a("<div>"+b.$navigateUrl.html()+"</div>").addClass("ui-widget-header ui-corner-all")},start:function(a){b._tree._isDragging=true;b._tree._trigger("nodeDragStarted",a,b);b._tree.widgetDom.prepend(b._insertionTemplate);d.hide()},distance:a.browser.msie?1:10,handle:b.$navigateUrl,scope:"tree",drag:function(e){var h=e.srcElement||e.originalEvent.target,f=a(h),d,g={x:e.pageX,y:e.pageY};c&&c.hide();if(f){d=b._getNodeWidget(f);if(d)if(f.closest(".wijmo-wijtree-inner",b.element).length){b._dropTarget=d;b._insertPosition="end"}else{c.show();b._insertPosition=b._drowTemplate(g,c,d.element);b._dropTarget=d}}b._tree._trigger("nodeDragging",e,b)},stop:function(){d.show();c.remove();b._dropTarget=null;b._insertPosition="unKnown";b._resetDrag()}}).trigger(e);a.browser.mozilla&&b._setFocused(true)},_resetDrag:function(){var a=this,c,b;!a._tree.options.allowDrag&&a.element.data("draggable")&&a.element.draggable("destroy");c=a._getField("nodes");for(b=0;b<c.length;b++)c[b]._resetDrag()},_checkClick:function(){var a=this,b=a.options;if(!a._tree.options.disabled&&!a._isClosestDisabled()){if(b.checked&&a._checkState==="indeterminate"){a._checkState="checked";a._checkItem()}else{a._checkState=b.checked?"unChecked":"checked";a._setChecked(!b.checked)}a._tree._trigger("nodeCheckChanged",null,a)}},_checkItem:function(){var a=this,c=false,b=a._tree;if(b===null||!b.options.showCheckBoxes)return;if(b.options.autoCheckNodes&&a._checkState!=="indeterminate"){c=true;a._changeCheckState(a.options.checked)}b.options.allowTriState&&a._setParentCheckState();a[a.options.checked?"_checkNode":"_unCheckNode"](c)},_checkNode:function(e){var a=this,d=a.options,c=this._getField("nodes"),b;if(a._checkState==="checked"){a.$checkBox.wijtreecheck("option","checkState","check");d.checkState="checked"}else if(a._checkState==="indeterminate"){a.$checkBox.wijtreecheck("option","checkState","triState");d.checkState="indeterminate"}if(e)for(b=0;b<c.length;b++)c[b]._checkNode(true)},_unCheckNode:function(c){var b=this._getField("nodes"),d=this.options,a;this.$checkBox.wijtreecheck("option","checkState","unCheck");d.checkState="unChecked";if(c)for(a=0;a<b.length;a++)b[a]._unCheckNode(true)},_changeCheckState:function(b){var c=this._getField("nodes");a.each(c,function(c,a){a.options.checked=b;a.$nodeBody.attr("aria-checked",b);a._checkState=b?"checked":"unChecked";a._changeCheckState(b)})},_setParentCheckState:function(){var a=this._getOwner(),c,e=true,d=false,f=false,b,g=this;if(a.element.is(":"+g.options.treeClass))return;c=a._getField("nodes");for(b=0;b<c.length;b++){if(c[b]._checkState==="indeterminate")f=true;if(c[b].options.checked)d=true;else e=false;if(!e&&d)break}if(f){a._checkState="indeterminate";a._setChecked(true)}else if(d){if(e){a._checkState="checked";a._checkNode(false)}else a._checkState="indeterminate";a._setChecked(true)}else{a._checkState="unChecked";a._setChecked(false);a._unCheckNode(false)}a._setParentCheckState()},_onKeyDown:function(b){var d=a(b.target),c=this;d.closest(".wijmo-wijtree-inner",c.element).length>0&&c._keyAction(b)},_onClick:function(b){var d=a(b.target),c=this;if(d.closest(".wijmo-checkbox",c.element).length>0){c._checkClick(b);b.preventDefault();b.stopPropagation()}else if(d.hasClass("ui-icon-triangle-1-se")||d.hasClass("ui-icon-triangle-1-e")){c._expandCollapseItem(b);b.preventDefault();b.stopPropagation()}else d.closest(".wijmo-wijtree-inner",c.element).length>0&&c._click(b)},_onMouseDown:function(b){var d=a(b.target),c=b.data;if(c._tree.options.allowDrag)d.closest(".wijmo-wijtree-node",c.element).length>0&&c._beginDrag(b)},_onMouseOver:function(c){var e=a(c.target),b=this,d=a(c.relatedTarget);if(e.closest(".wijmo-wijtree-inner",b.element).length>0&&(this._tree._overNode!==b||d.is(":"+this.widgetBaseClass))){b._mouseOver(c);this._tree._overNode=b}b._mouseOverHitArea(c)},_onMouseOut:function(b){var f=a(b.target),c=this,e=a(b.relatedTarget),d=this._getNodeWidget(e);if(f.closest(".wijmo-wijtree-inner",c.element).length>0&&(this._tree._overNode!==d||e.is(":"+this.widgetBaseClass))){c._mouseOut(b);if(!d)this._tree._overNode=null}c._mouseOutHitArea(b)},_onFocus:function(d){var c=a(d.target),b=this;if(c.closest(".wijmo-wijtree-inner",b.element).length>0&&!b._tree.options.disabled&&!b._isClosestDisabled()&&!(c.hasClass("ui-icon-triangle-1-se")||c.hasClass("ui-icon-triangle-1-e"))&&!c.closest(".wijmo-checkbox",b.element).length){b._tree._focusNode&&b._tree._focusNode.$navigateUrl.blur();b._focused=true;b._tree._focusNode=this;b.$inner.addClass("ui-state-focus")}},_onBlur:function(c){var d=a(c.target),b=c.data;if(!b._tree.options.disabled&&!b._isClosestDisabled()){b._focused=false;d.closest(".wijmo-wijtree-inner",b.element).length>0&&b.$inner.removeClass("ui-state-focus");b._tree._trigger("nodeBlur",c,b)}},_click:function(c){var a=this,d=a.options,b=a._tree;if(!b.options.disabled&&!a._isClosestDisabled()){if(!/^[#,\s]*$/.test(a._navigateUrl))return;a._isClick=true;b._ctrlKey=c.ctrlKey;if(d.selected&&b._ctrlKey)a._setSelected(false);else if(d.selected&&b.options.allowEdit&&!a._isTemplate)a._editNode();else a._setSelected(!d.selected);if(!a._isTemplate){c.preventDefault();c.stopPropagation()}}else a._setNavigateUrlHref("")},_selectNode:function(e,f){var b=this,d,c;if(!b._tree.options.disabled&&!b._isClosestDisabled()&&!b._tree._isDragging){d=b._tree._ctrlKey;if(d){c=a.inArray(b,b._tree._selectedNodes);if(c!==-1&&!e){b._tree._selectedNodes.splice(c,1);b.$inner.removeClass("ui-state-active")}}else{a.each(b._tree._selectedNodes,function(b,a){a.$inner.removeClass("ui-state-active");a.options.selected=false;a.$nodeBody.attr("aria-selected",false)});b._tree._selectedNodes=[]}if(e){c=a.inArray(b,b._tree._selectedNodes);c===-1&&this._tree._selectedNodes.push(b);b.$inner.addClass("ui-state-active")}else b.$inner.removeClass("ui-state-active");b._isClick&&b._tree._trigger("nodeClick",f,b);b._isClick=false;b._tree._ctrlKey=false;b._tree._trigger("selectedNodeChanged",f,b)}},_keyAction:function(c){var d=c.target,b=this;if(b._tree.options.disabled||b._isClosestDisabled())return;if(d){if(b._tree._editMode&&c.keyCode!==a.ui.keyCode.ENTER)return;switch(c.keyCode){case a.ui.keyCode.UP:b._moveUp();break;case a.ui.keyCode.DOWN:b._moveDown();break;case a.ui.keyCode.RIGHT:b._tree.options.showExpandCollapse&&b._moveRight();break;case a.ui.keyCode.LEFT:b._tree.options.showExpandCollapse&&b._moveLeft();break;case 83:!b._tree._editMode&&b._tree.options.allowSorting&&b.sortNodes();break;case 113:b._tree.options.allowEdit&&b._editNode();break;case 109:b._tree.options.showExpandCollapse&&this._expanded&&b._setExpanded(false);break;case 107:b._tree.options.showExpandCollapse&&!this._expanded&&b._setExpanded(true);break;case a.ui.keyCode.ENTER:if(b._tree._editMode){c.data=b;b._editionComplete(c)}break;case a.ui.keyCode.SPACE:if(b._tree.options.showCheckBoxes){b._checkState=b.options.checked?"unChecked":"checked";b._setChecked(!b.options.checked)}}b._customKeyDown(c.keyCode);if(!b._isTemplate){c.preventDefault();c.stopPropagation()}}},_customKeyDown:function(){},_prevNode:function(a){if(a.element.prev().length>0)return a.element.prev().data(this.widgetName)},_nextNode:function(a){if(a.element.next().length>0)return a.element.next().data(this.widgetName)},_getNextExpandedNode:function(c){var d=c,a=c._getField("nodes"),b;if(c._expanded&&a.length>0){b=a[a.length-1];if(b!==null)d=this._getNextExpandedNode(b)}return d},_getNextNode:function(b){var a=null,c=this;if(b.element.is(":"+c.options.treeClass))return null;a=c._nextNode(b);return a?a:c._getNextNode(b._getOwner())},_moveUp:function(){var b=this._getCurrentLevel(),a=this._prevNode(this);if(!a)b>0&&this._getOwner()._setFocused(true);else this._getNextExpandedNode(a)._setFocused(true)},_moveDown:function(){var c=this._getField("nodes"),b,d,a;if(this._expanded&&c.length>0)c[0]._setFocused(true);else{b=this._nextNode(this);if(b)b._setFocused(true);else{d=this._getOwner();a=this._getNextNode(d);a&&a._setFocused(true)}}},_moveLeft:function(){var a=this._getOwner();if(this._expanded)this._setExpanded(false);else a!==null&&!a.element.is(":"+this.options.treeClass)&&a._setFocused(true)},_moveRight:function(){if(this._hasChildren)if(!this._expanded)this._setExpanded(true);else{var a=this._getField("nodes")[0];a!==null&&a._setFocused(true)}},_mouseOver:function(c){var a=this,b=a._tree;if(!b.options.disabled&&!a._isClosestDisabled()&&!b._editMode){a._mouseOverNode();!b._isDragging&&b._trigger("nodeMouseOver",c,a)}},_mouseOut:function(c){var a=this,b=a._tree;if(!b.options.disabled&&!a._isClosestDisabled()&&!b._editMode){a._mouseOutNode();!b._isDragging&&b._trigger("nodeMouseOut",c,a)}},_mouseOverNode:function(){if(this.$inner!==null&&!this._isOverNode){this.$inner.addClass("ui-state-hover");this._isOverNode=true}},_mouseOutNode:function(){if(this.$inner!==null&&this._isOverNode){this.$inner.removeClass("ui-state-hover");this._isOverNode=false}},_mouseOverHitArea:function(c){var b,e,a=this,d=a._tree;if(!d.options.disabled&&!a._isClosestDisabled())if(d.options.expandCollapseHoverUsed)if(a._hasChildren&&!a._isOverHitArea){b=a._getBounds(a.element);e={x:c.pageX,y:c.pageY};if(a._isMouseInsideRect(e,b)){a._isOverHitArea=true;a._setExpanded(true)}}},_mouseOutHitArea:function(c){var e={x:c.pageX,y:c.pageY},b,a=this,d=a._tree;if(!d.options.disabled&&!a._isClosestDisabled())if(d.options.expandCollapseHoverUsed)if(a._hasChildren&&!!a._isOverHitArea){b=a._getBounds(a.element);if(!a._isMouseInsideRect(e,b)){a._isOverHitArea=false;a._setExpanded(false)}}else if(a._getOwner().element.is(":"+a.widgetBaseClass)){b=a._getBounds(a._getOwner().element);if(!a._isMouseInsideRect(e,b)){a._getOwner()._isOverHitArea=false;a._getOwner()._setExpanded(false)}}},destroy:function(){var b=this,c;b.element.data("draggable")&&b.element.draggable("destroy");b.$hitArea&&b.$hitArea.remove();b.$checkBox&&b.$checkBox.remove();b.$nodeImage&&b.$nodeImage.remove();b.$navigateUrl.unwrap().unwrap().removeClass("ui-state-default ui-state-active").unbind("mousedown").unbind("blur");c=this.element.find("ul:first").show();c.removeClass();c.children("li").each(function(){var c=b._getNodeWidget(a(this));c.destroy()});b.element.removeData("nodes").removeData("owner").removeData("widgetName").removeClass();a.Widget.prototype.destroy.apply(this)},add:function(b,f){var e=null,d,g,c=this,i="<li><a href='{0}'>{1}</a></li>",h;if(typeof b==="string"){d=a(i.replace(/\{0\}/,"#").replace(/\{1\}/,b));c._createNodeWidget(d);e=d.data(d.data("widgetName"))}else if(b.jquery){!b.data("widgetName")&&c._createNodeWidget(b);e=b.data(b.data("widgetName"))}else if(b.nodeType){d=a(b);c._createNodeWidget(d);e=d.data(d.data("widgetName"))}else if(a.isPlainObject(b)){d=a(i.replace(/\{0\}/,b.url).replace(/\{1\}/,b.text));c._createNodeWidget(d,b);e=d.data(d.data("widgetName"))}if(e===null)return;g=c._getField("nodes");if(!f||f>g.length)if(f!==0)f=g.length;e._setField("owner",c);h=g.length;if(!c.$nodes){c.$nodes=a("<ul></ul>").addClass("wijmo-wijtree-list ui-helper-reset wijmo-wijtree-child");c.element.append(c.$nodes)}if(h>0&&h!==f)e.element.get(0)!==g[f].element.get(0)&&e.element.insertBefore(g[f].element);else c.$nodes.append(e.element);c._changeCollection(f,e);c._collectionChanged("add")},remove:function(b){var a=-1,c,e=this,d=this._getField("nodes");if(b.jquery)a=b.index();else if(typeof b==="number")a=b;if(a<0&&a>=d.length)return;c=d[a];c.element.detach();e._changeCollection(a);e._collectionChanged("remove")},_changeCollection:function(c,a){var b=this._getField("nodes");if(a)b.splice(c,0,a);else b.splice(c,1)},sortNodes:function(){var b=this._getField("nodes");this._sort();a.each(b,function(b,a){a._index=b;a._insertBefore(b)});this._refreshNodesClass()},check:function(a){this._setOption("checked",a)},select:function(a){this._setOption("selected",a)},expand:function(){this._setOption("expanded",true)},collapse:function(){this._setOption("expanded",false)},_insertBefore:function(a){var b=this.element.parent().children("li");this.element.index()!==a&&this.element.insertBefore(b.eq(a))},_sort:function(){var a=this._getField("nodes");if(this._isSorted)if(!this._isDecsSort){a.sort(this._compare2NodeTextAcs);this._isDecsSort=true}else{a.sort(this._compare2NodeTextDesc);this._isDecsSort=false}else{a.sort(this._compare2NodeTextAcs);this._isSorted=true;this._isDecsSort=true}},_compare2NodeTextAcs:function(a,b){if(a!==null&&b!==null)return a._text.localeCompare(b._text)},_compare2NodeTextDesc:function(a,b){if(a!==null&&b!==null)return-1*a._text.localeCompare(b._text)},_collectionChanged:function(){this._hasChildren=this._getChildren();this._initNodeClass();this._refreshNodesClass()},_refreshNodesClass:function(){for(var b=this._getField("nodes"),a=0;a<b.length;a++)b[a]._initNodeClass()},_setChecked:function(b){var a=this;if(a.options.checked===b&&a._checkState!=="indeterminate")return;a.options.checked=b;a.$nodeBody.attr("aria-checked",b);this._checkItem()},_isClosestDisabled:function(){var a=this;return a.element.closest(".wijmo-wijtree-disabled,.wijmo-wijtreenode-disabled",a._tree.element).length?true:false},_setExpanded:function(b){var a=this;if(a._expanded===b)return;if(a._hasChildren){a._expanded=b;a.options.expanded=b;a.$nodeBody.attr("aria-expanded",b);a._expandNode(b)}},_setFocused:function(b){if(b){this.$navigateUrl.focus();(a.browser.msie||a.browser.webkit)&&this._setFocusNode()}else this.$navigateUrl.blur()},_setFocusNode:function(){this._tree._focusNode&&a.browser.webkit&&this._tree._focusNode.$navigateUrl.blur();this._focused=true;this._tree._focusNode=this;this.$inner.addClass("ui-state-focus")},_setToolTip:function(a){if(a.length)this.element.attr("title",a);else this.element.removeAttr("title")},_setText:function(a){if(this._text!==a&&a.length){this._text=a;this._changeText(a)}},_setSelected:function(a){var b=this,c=b.options;if(c.selected!==a){c.selected=a;b.$nodeBody.attr("aria-selected",a);b._selectNode(a);b._setFocused(a)}},_setCheckBoxes:function(c){var b=this;b.$checkBox&&b.$checkBox[c?"show":"hide"]();b.$nodes&&b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!==null&&d._setCheckBoxes(c)})},_setHitArea:function(c){var b=this;if(b._hasChildren)if(c){b._initNodeClass();b.$hitArea&&b.$hitArea.show()}else{b._expanded=true;b.options.expanded=true;b.$nodeBody.attr("aria-expanded",true);b.$nodes&&b.$nodes.show();b._initNodeClass();b.$hitArea&&b.$hitArea.hide()}b.$nodes&&b.$nodes.children("li").each(function(){var d=b._getNodeWidget(a(this));d!==null&&d._setHitArea(c)})},_getOwner:function(){return this._getField("owner")},_getTree:function(){var a=this._getOwner();return a?a.element.is(":"+this.options.treeClass)?a:a._getTree():null},_getChildren:function(){return this.element.find(">ul:first>li").length>0&&this.element.children("ul:first")},_getNodeWidget:function(c){var a=this._getNodeByDom(c),b;if(a.length>0){b=a.data(a.data("widgetName"));return b}return null},_createNodeWidget:function(c,b){if(a.fn.wijtreenode){c.data("owner",this);if(!!b&&a.isPlainObject(b)){a.extend(b,{treeClass:this.options.treeClass});c.wijtreenode(b)}else c.wijtreenode({treeClass:this.options.treeClass})}return c},_getNodeByDom:function(b){return a(b).closest(":"+this.widgetBaseClass)},_getCurrentLevel:function(){return this.element.parentsUntil(":"+this.options.treeClass).length-1},_getField:function(a){return this.element.data(a)},_setField:function(b,a){return this.element.data(b,a)}})})(jQuery);(function(a){var c="ui-icon ui-icon-check",b="ui-icon ui-icon-stop";a.widget("wijmo.wijtreecheck",{options:{checkState:"unCheck"},_create:function(){var b=this,c=this.options;if(b.element.is("div")){b.element.addClass("wijmo-checkbox ui-widget");b.$icon=a("<span>");b.$icon.addClass("wijmo-checkbox-icon");if(c.checkState==="check")b.$icon.addClass("ui-icon ui-icon-check");else c.checkState==="triState"&&b.$icon.addClass("ui-icon ui-icon-stop");b.$body=a("<div></div>").addClass("wijmo-checkbox-box ui-widget ui-corner-all ui-state-default").css({position:"relative"}).append(b.$icon);b.element.append(b.$body);b.element.bind("mouseover.wijtreecheck",function(){!b.options.disabled&&b.$body.removeClass("ui-state-default").addClass("ui-state-hover")}).bind("mouseout.wijtreecheck",function(){!b.options.disabled&&b.$body.removeClass("ui-state-hover").not(".ui-state-focus").addClass("ui-state-default")})}},_setOption:function(f,e){var d=this;if(f==="checkState")if(e==="unCheck"){d.$body.removeClass("ui-state-active");d.$icon.removeClass("ui-icon ui-icon-check ui-icon-stop ui-state-active")}else if(e==="check"){d.$body.addClass("ui-state-active");d.$icon.removeClass(b).addClass(c)}else if(e==="triState"){d.$body.addClass("ui-state-active");d.$icon.removeClass(c).addClass(b)}a.Widget.prototype._setOption.apply(d,arguments)},destory:function(){this.element.children().remove();this.element.removeClass("wijmo-checkbox ui-widget");a.Widget.prototype.destroy.apply(this)}})})(jQuery);